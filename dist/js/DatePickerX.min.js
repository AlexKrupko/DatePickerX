/**
 * DatePickerX
 *
 * Cool light visual date picker on pure JavaScript
 * Browsers support: Chrome 45+, FireFox 40+, Safari 8+, IE 11+, Edge 15+, iOS Safari, Android Google Chrome
 *
 * @author    Alexander Krupko <alex.krupko@ukr.net>
 * @copyright 2016 Alexander Krupko
 * @license   MIT
 * @version   1.1.0
 */
!function(){'use strict';function a(a,b,c,d,e){b=b||[],!Array.isArray(b)&&(b=[b]);var f=document.createElement(a);'button'===a&&f.setAttribute('type','button');for(var g=b.length;g--;f.classList.add(b[g]));return e&&(f.title=e),f.innerHTML=d||'',c instanceof Element&&c.appendChild(f),f}function b(a){return a=a||new Date,new Date(a.getFullYear(),a.getMonth(),a.getDate())}function c(c){function g(){var a=r.minDate;return a instanceof HTMLInputElement?(a=a.DatePickerX.getValue(!0),a=null===a?r.minDate.DatePickerX.getMinDate():new Date(a),a.setDate(a.getDate()+1)):'function'==typeof a&&(a=new Date(a()),isNaN(a)&&(console.error('DatePickerX, getMinDate: Invalid date value.'),a=d.minDate)),b(a)}function h(){var a=r.maxDate;return a instanceof HTMLInputElement?(a=a.DatePickerX.getValue(!0),a=null===a?r.maxDate.DatePickerX.getMaxDate():new Date(a),a.setDate(a.getDate()-1)):'function'==typeof a&&(a=new Date(a()),isNaN(a)&&(console.error('DatePickerX, getMaxDate: Invalid date value.'),a=d.maxDate)),b(a)}function i(){s.container=a('div','date-picker-x');var b=a('div','dpx-title-box',s.container);if(s.prevTitle=a('button','dpx-prev',b,'&#x276e;'),s.title=a('button','dpx-title',b),s.nextTitle=a('button','dpx-next',b,'&#x276f;'),s.content=a('div','dpx-content-box',s.container),c.nextElementSibling?c.parentNode.insertBefore(s.container,c.nextElementSibling):c.parentNode.appendChild(s.container),r.todayButton||r.clearButton){var d=a('div','dpx-btns',s.container);r.todayButton&&(s.today=a('button',['dpx-item','dpx-today'],d,r.todayButtonLabel,r.todayButtonLabel)),r.clearButton&&(s.clear=a('button',['dpx-item','dpx-clear'],d,r.clearButtonLabel,r.clearButtonLabel))}}function j(a,b){var c={d:a.getDate(),dd:a.getDate(),D:a.getDay(),m:a.getMonth()+1,mm:a.getMonth()+1,M:a.getMonth(),MM:a.getMonth(),yy:a.getFullYear().toString().substr(-2),yyyy:a.getFullYear()};return c.dd<10&&(c.dd='0'+c.dd),c.mm<10&&(c.mm='0'+c.mm),c.D=r.weekDayLabels[c.D?c.D-1:6],c.M=r.shortMonthLabels[c.M],c.MM=r.singleMonthLabels[c.MM],b.replace(/([dmM]{1,2}|D|yyyy|yy)/g,function(a){return'undefined'!=typeof c[a]?c[a]:a})}function k(){return s.container.classList.contains('active')}function l(a){if(!k()){a.stopPropagation(),v=2,o(),s.container.classList.add('active'),s.container.classList.remove('to-top');var b=s.container.getBoundingClientRect();b.bottom>window.innerHeight&&b.top+c.offsetHeight>s.container.offsetHeight&&(s.container.classList.add('to-top'),s.container.getBoundingClientRect().top<0&&s.container.classList.remove('to-top')),e&&e!==s.container&&m(),e=s.container;var d=Array.prototype.slice.call(s.container.querySelectorAll('button'));Array.prototype.slice.call(document.querySelectorAll('[href], input, select, textarea, button, iframe, object, embed, [tabindex], [contenteditable]')).filter(function(a){return d.indexOf(a)<0&&a.tabIndex>=0}).forEach(function(a){a.dataset.datepickerxDisabledTabIndex=a.tabIndex,a.tabIndex=-1}),d.forEach(function(a){a.tabIndex=0})}}function m(){e&&(e.classList.remove('active'),Array.prototype.slice.call(document.querySelectorAll('[data-datepickerx-disabled-tab-index]')).forEach(function(a){a.tabIndex=a.dataset.datepickerxDisabledTabIndex,delete a.dataset.datepickerxDisabledTabIndex}),Array.prototype.slice.call(e.querySelectorAll('button')).forEach(function(a){a.tabIndex=-1}),e=null)}function n(a){var d={37:'left',38:'top',39:'right',40:'bottom'};c.addEventListener('click',l),!f&&window.addEventListener('keydown',function(a){if(13===a.keyCode)document.activeElement===c&&(a.preventDefault(),l(a));else if(27===a.keyCode)a.preventDefault(),m();else if(k()&&a.keyCode in d){a.preventDefault();var b=Array.prototype.slice.call(s.container.querySelectorAll('button:enabled'));document.activeElement&&b.indexOf(document.activeElement)>=0?document.activeElement.neighbors&&document.activeElement.neighbors[d[a.keyCode]].focus():b[0].focus()}}),!f&&window.addEventListener('click',m),s.container.addEventListener('click',function(a){a.stopPropagation(),a.preventDefault()}),s.content.addEventListener('click',function(b){if(2===v)a.setValue(b.target.dpxValue)&&m();else{var c=g(),d=h();c.setDate(1),d.setDate(1),v||(c.setMonth(0),d.setMonth(0)),b.target.dpxValue>=c.getTime()&&b.target.dpxValue<=d.getTime()&&++v&&o(b.target.dpxValue)}}),s.prevTitle.addEventListener('click',function(){o(this.dpxValue)}),s.nextTitle.addEventListener('click',function(){o(this.dpxValue)}),s.title.addEventListener('click',function(){v&&v--&&o(this.dpxValue)}),s.today&&s.today.addEventListener('click',function(){!this.disabled&&a.setValue(b())&&m()}),s.clear&&s.clear.addEventListener('click',function(){a.setValue(null)&&m()}),f=!0}function o(c){s.content.innerHTML='';var d=g(),e=h(),f=b();r.todayButton&&(s.today.disabled=f<d||f>e),v<2&&(d.setDate(1),e.setDate(1),v||(d.setMonth(0),e.setMonth(0))),d=d.getTime(),e=e.getTime(),c=b(new Date(c||u||Date.now())),c.getTime()<d?c=new Date(d):c.getTime()>e&&(c=new Date(e));var i=c.getMonth(),k=c.getFullYear(),l=10*Math.floor(k/10);if(c=new Date(v?k:l,v<2?0:i),s.title.innerHTML=v?j(c,2===v?r.titleFormatMonth:r.titleFormatYear):l+' - '+(l+9),s.title.dpxValue=c.getTime(),s.title.title=2===v?j(c,r.titleFormatYear):l+' - '+(l+9),s.title.disabled=!v,s.prevTitle.disabled=c.getTime()<=d,2===v?c.setMonth(i-1):c.setFullYear(v?k-1:l-10),s.prevTitle.title=v?j(c,2===v?r.titleFormatMonth:r.titleFormatYear):l-10+' - '+(l-1),s.prevTitle.dpxValue=c.getTime(),2===v?c.setMonth(c.getMonth()+2):c.setFullYear(v?k+1:l+20),s.nextTitle.disabled=c.getTime()>e,s.nextTitle.title=v?j(c,2===v?r.titleFormatMonth:r.titleFormatYear):l+10+' - '+(l+19),s.nextTitle.dpxValue=c.getTime(),2===v?c.setMonth(c.getMonth()-1):c.setFullYear(v?k:l),2===v){var m=r.weekDayLabels.length;!r.mondayFirst&&--m&&a('span',['dpx-item','dpx-weekday','dpx-weekend'],s.content,r.weekDayLabels[6]);for(var n=0;n<m;++n){var o=['dpx-item','dpx-weekday'];n>4&&o.push('dpx-weekend'),a('span',o,s.content,r.weekDayLabels[n])}}if(2===v){var q=c.getDay();c.setDate(r.mondayFirst?-(q?q-2:5):-q+1)}else v?c.setMonth(c.getMonth()-2):c.setFullYear(l-3);v<2&&(f.setDate(1),!v&&f.setMonth(0)),f=f.getTime(),s.container.setAttribute('data-dpx-type',['year','month','day'][v]);for(var t=['getFullYear','getMonth','getDate'][v],w=['setFullYear','setMonth','setDate'][v],x=2===v?6:4,y=2===v?7:4,z=[],A=x*y;A--;c[w](c[t]()+1)){var o=['dpx-item'],B=j(c,[r.titleFormatYear,r.titleFormatMonth,r.titleFormatDay][v]);(v?2===v?c.getMonth()!==i:c.getFullYear()!==k:c.getFullYear()<l||c.getFullYear()>l+9)&&o.push('dpx-out'),2===v&&(6===c.getDay()||0===c.getDay())&&o.push('dpx-weekend'),c.getTime()===f&&o.push('dpx-current'),c.getTime()===u&&o.push('dpx-selected');var C=v?2===v?c.getDate():r.shortMonthLabels[c.getMonth()]:c.getFullYear(),D=a('button',o,s.content,C,B);D.dpxValue=c.getTime(),D.disabled=c.getTime()<d||c.getTime()>e,z.push(D)}p(z,x,y)}function p(a,b,c){function d(a){return g.length?1===g.length?g[0]:s.title.disabled?g[Math.floor(a/Math.ceil(c/2))]:[s.prevTitle.disabled?s.title:s.prevTitle,s.prevTitle.disabled||c<7?s.title:s.prevTitle,s.title,s.nextTitle.disabled||c>4?s.title:s.nextTitle,s.title,s.nextTitle.disabled?s.title:s.nextTitle,s.nextTitle.disabled?s.title:s.nextTitle][a]:null}function e(a){return h.length?h[Math.floor(a/Math.ceil(c/h.length))]:null}function f(a,b,c){a.neighbors={left:c[b>0?b-1:c.length-1],right:c[b<c.length-1?b+1:0]}}var g=[];!s.prevTitle.disabled&&g.push(s.prevTitle),!s.title.disabled&&g.push(s.title),!s.nextTitle.disabled&&g.push(s.nextTitle);var h=[];s.today&&!s.today.disabled&&h.push(s.today),s.clear&&h.push(s.clear);var i=a.filter(function(a){return!a.disabled});g.forEach(function(a,b,c){f(a,b,c),a.neighbors.bottom=i[0],a.neighbors.top=h.length?h[0]:i[i.length-1]}),h.forEach(function(a,b,c){f(a,b,c),a.neighbors.top=i[i.length-1],a.neighbors.bottom=g.length?g[0]:i[0]});for(var j=0;j<c*b;j+=c)a.slice(j,j+c).filter(function(a){return!a.disabled}).forEach(f);for(var j=0;j<c;j++)a.filter(function(a,b){return!a.disabled&&b%c===j}).forEach(function(a,b,c){b?a.neighbors.top=c[b-1]:a.neighbors.top=d(j)||e(j)||c[c.length-1],b===c.length-1?a.neighbors.bottom=e(j)||d(j)||c[0]:a.neighbors.bottom=c[b+1]})}function q(a,b){if('undefined'==typeof r[a])return console.error('DatePickerX, setOption: Option doesn\'t exist.')&&!1;if('minDate'===a||'maxDate'===a){if(!(b instanceof HTMLInputElement)&&'function'!=typeof b&&(!(b instanceof Date)&&(b=new Date(b)),isNaN(b)))return console.error('DatePickerX, setOption: Invalid date value.')&&!1}else{if(typeof r[a]!=typeof b)return console.error('DatePickerX, setOption: Option has invalid type.')&&!1;if(Array.isArray(r[a])){if(b.length<r[a].length)return console.warn('DatePickerX, setOption: Invalid option length.')&&!1;b=b.slice(0,r[a].length)}}r[a]=b}var r={},s={},t=!1,u=null,v=2;return{init:function(a){if(a=a||{},t)return console.error('DatePickerX, init: Date picker has been already initiated.')&&!1;t=!0,r={};for(var b in d)r[b]=d[b];if('object'!=typeof a)console.error('DatePickerX, init: Initial options must be an object.');else for(var b in a)q(b,a[b]);return c.parentNode.classList.add('date-picker-x-container'),c.classList.add('date-picker-x-input'),c.readOnly=!0,i(),n(this),!0},remove:function(){return t?(c.parentNode.removeChild(s.container),c.classList.remove('date-picker-x-input'),c.readOnly=t=!1,!0):console.error('DatePickerX, remove: Date picker has not been initiated yet.')&&!1},setValue:function(a,b){if(!t)return console.error('DatePickerX, remove: Date picker has not been initiated yet.')&&!1;if(null===a)u=null,c.value='';else{if(!(a instanceof Date)&&(a=new Date(a)),isNaN(a))return console.error('DatePickerX, setValue: Can\'t convert argument to date.')&&!1;if(!b&&(a.getTime()<g().getTime()||a.getTime()>h().getTime()))return console.error('DatePickerX, setValue: Date out of acceptable range.')&&!1;u=a.getTime(),c.value=j(a,r.format)}var d=document.createEvent('Event');return d.initEvent('change',!0,!0),c.dispatchEvent(d),k()&&o(),!0},getValue:function(a){return!t&&console.error('DatePickerX, getValue: Date picker has not been initiated yet.'),a?u:null===u?'':j(new Date(u),r.format)},getMinDate:function(){var a=r.minDate;return a instanceof HTMLInputElement?a=a.DatePickerX.getMinDate():'function'==typeof a&&(a=new Date(a()),isNaN(a)&&(console.error('DatePickerX, getMinDate: Invalid date value.'),a=d.minDate)),b(a)},getMaxDate:function(){var a=r.maxDate;return a instanceof HTMLInputElement?a=a.DatePickerX.getMaxDate():'function'==typeof a&&(a=new Date(a()),isNaN(a)&&(console.error('DatePickerX, getMaxDate: Invalid date value.'),a=d.maxDate)),b(a)}}}var d={mondayFirst:!0,format:'yyyy/mm/dd',minDate:new Date(0,0),maxDate:new Date(9999,11,31),weekDayLabels:['Mo','Tu','We','Th','Fr','St','Su'],shortMonthLabels:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],singleMonthLabels:['January','February','March','April','May','June','July','August','September','October','November','December'],todayButton:!0,todayButtonLabel:'Today',clearButton:!0,clearButtonLabel:'Clear',titleFormatDay:'MM dd, yyyy',titleFormatMonth:'MM yyyy',titleFormatYear:'yyyy'},e=null,f=!1,g=[],h=[];Object.defineProperty(HTMLInputElement.prototype,'DatePickerX',{get:function(){var a=g.indexOf(this);return a===-1&&(a=g.push(this)-1,h.push(new c(this))),h[a]},set:function(){}}),window.DatePickerX={setDefaults:function(a){if('object'!=typeof a)return console.error('DatePickerX, setDefaults: Invalid option type.')&&!1;for(var b in a)typeof a[b]==typeof d[b]&&(Array.isArray(d[b])?a[b].length>=d[b].length&&(d[b]=a[b].slice(0,d[b].length)):d[b]=a[b]);return!0}}}();