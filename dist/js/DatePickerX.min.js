/**
 * DatePickerX
 *
 * Cool light visual date picker on pure JavaScript
 * Browsers support: Chrome 45+, FireFox 40+, Safari 8+, IE 11+, Edge 15+, iOS Safari, Android Google Chrome
 *
 * @author    Alexander Krupko <alex.krupko@ukr.net>
 * @copyright 2016 Alexander Krupko
 * @license   MIT
 * @version   1.1.0
 */
!function(){'use strict';function a(a,b,c,d,e){b=b||[],!Array.isArray(b)&&(b=[b]);var f=document.createElement(a);'button'===a&&f.setAttribute('type','button');for(var g=b.length;g--;f.classList.add(b[g]));return e&&(f.title=e),f.innerHTML=d||'',c instanceof Element&&c.appendChild(f),f}function b(a){return a=a||new Date,new Date(a.getFullYear(),a.getMonth(),a.getDate())}function c(c){function f(){var a=q.minDate;return a instanceof HTMLInputElement?(a=a.DatePickerX.getValue(!0),a=null===a?q.minDate.DatePickerX.getMinDate():new Date(a),a.setDate(a.getDate()+1)):'function'==typeof a&&(a=new Date(a()),isNaN(a)&&(console.error('DatePickerX, getMinDate: Invalid date value.'),a=d.minDate)),b(a)}function g(){var a=q.maxDate;return a instanceof HTMLInputElement?(a=a.DatePickerX.getValue(!0),a=null===a?q.maxDate.DatePickerX.getMaxDate():new Date(a),a.setDate(a.getDate()-1)):'function'==typeof a&&(a=new Date(a()),isNaN(a)&&(console.error('DatePickerX, getMaxDate: Invalid date value.'),a=d.maxDate)),b(a)}function h(){r.container=a('div','date-picker-x');var b=a('div','dpx-title-box',r.container);if(r.prevTitle=a('button','dpx-prev',b,'&#x276e;'),r.title=a('button','dpx-title',b),r.nextTitle=a('button','dpx-next',b,'&#x276f;'),r.content=a('div','dpx-content-box',r.container),c.nextElementSibling?c.parentNode.insertBefore(r.container,c.nextElementSibling):c.parentNode.appendChild(r.container),q.todayButton||q.clearButton){var d=a('div','dpx-btns',r.container);q.todayButton&&(r.today=a('button',['dpx-item','dpx-today'],d,q.todayButtonLabel,q.todayButtonLabel)),q.clearButton&&(r.clear=a('button',['dpx-item','dpx-clear'],d,q.clearButtonLabel,q.clearButtonLabel))}}function i(a,b){var c={d:a.getDate(),dd:a.getDate(),D:a.getDay(),m:a.getMonth()+1,mm:a.getMonth()+1,M:a.getMonth(),MM:a.getMonth(),yy:a.getFullYear().toString().substr(-2),yyyy:a.getFullYear()};return c.dd<10&&(c.dd='0'+c.dd),c.mm<10&&(c.mm='0'+c.mm),c.D=q.weekDayLabels[c.D?c.D-1:6],c.M=q.shortMonthLabels[c.M],c.MM=q.singleMonthLabels[c.MM],b.replace(/([dmM]{1,2}|D|yyyy|yy)/g,function(a){return'undefined'!=typeof c[a]?c[a]:a})}function j(){return r.container.classList.contains('active')}function k(a){if(!j()){a.stopPropagation(),u=2,n(),r.container.classList.add('active'),r.container.classList.remove('to-top');var b=r.container.getBoundingClientRect();b.bottom>window.innerHeight&&b.top+c.offsetHeight>r.container.offsetHeight&&(r.container.classList.add('to-top'),r.container.getBoundingClientRect().top<0&&r.container.classList.remove('to-top')),e&&e!==r.container&&l(),e=r.container;var d=Array.prototype.slice.call(r.container.querySelectorAll('button'));Array.prototype.slice.call(document.querySelectorAll('[href], input, select, textarea, button, iframe, object, embed, [tabindex], [contenteditable]')).filter(function(a){return d.indexOf(a)<0}).forEach(function(a){a.dataset.datepickerxDisabledTabIndex=a.tabIndex,a.tabIndex=-1}),d.forEach(function(a){a.tabIndex=0})}}function l(){e&&(e.classList.remove('active'),Array.prototype.slice.call(document.querySelectorAll('[data-datepickerx-disabled-tab-index]')).forEach(function(a){a.tabIndex=a.dataset.datepickerxDisabledTabIndex,delete a.dataset.datepickerxDisabledTabIndex}),Array.prototype.slice.call(e.querySelectorAll('button')).forEach(function(a){a.tabIndex=-1}))}function m(a){var d={37:'left',38:'top',39:'right',40:'bottom'};c.addEventListener('click',k),window.addEventListener('keydown',function(a){if(13===a.keyCode)document.activeElement===c&&(a.preventDefault(),k(a));else if(27===a.keyCode)a.preventDefault(),l();else if(j()&&a.keyCode in d){a.preventDefault();var b=Array.prototype.slice.call(r.container.querySelectorAll('button:enabled'));document.activeElement&&b.indexOf(document.activeElement)>=0?document.activeElement.neighbors&&document.activeElement.neighbors[d[a.keyCode]].focus():b[0].focus()}}),window.addEventListener('click',l),r.container.addEventListener('click',function(a){a.stopPropagation(),a.preventDefault()}),r.content.addEventListener('click',function(b){if(2===u)a.setValue(b.target.dpxValue)&&l();else{var c=f(),d=g();c.setDate(1),d.setDate(1),u||(c.setMonth(0),d.setMonth(0)),b.target.dpxValue>=c.getTime()&&b.target.dpxValue<=d.getTime()&&++u&&n(b.target.dpxValue)}}),r.prevTitle.addEventListener('click',function(){n(this.dpxValue)}),r.nextTitle.addEventListener('click',function(){n(this.dpxValue)}),r.title.addEventListener('click',function(){u&&u--&&n(this.dpxValue)}),r.today&&r.today.addEventListener('click',function(){!this.disabled&&a.setValue(b())&&l()}),r.clear&&r.clear.addEventListener('click',function(){a.setValue(null)&&l()})}function n(c){r.content.innerHTML='';var d=f(),e=g(),h=b();q.todayButton&&(r.today.disabled=h<d||h>e),u<2&&(d.setDate(1),e.setDate(1),u||(d.setMonth(0),e.setMonth(0))),d=d.getTime(),e=e.getTime(),c=b(new Date(c||t||Date.now())),c.getTime()<d?c=new Date(d):c.getTime()>e&&(c=new Date(e));var j=c.getMonth(),k=c.getFullYear(),l=10*Math.floor(k/10);if(c=new Date(u?k:l,u<2?0:j),r.title.innerHTML=u?i(c,2===u?q.titleFormatMonth:q.titleFormatYear):l+' - '+(l+9),r.title.dpxValue=c.getTime(),r.title.title=2===u?i(c,q.titleFormatYear):l+' - '+(l+9),r.title.disabled=!u,r.prevTitle.disabled=c.getTime()<=d,2===u?c.setMonth(j-1):c.setFullYear(u?k-1:l-10),r.prevTitle.title=u?i(c,2===u?q.titleFormatMonth:q.titleFormatYear):l-10+' - '+(l-1),r.prevTitle.dpxValue=c.getTime(),2===u?c.setMonth(c.getMonth()+2):c.setFullYear(u?k+1:l+20),r.nextTitle.disabled=c.getTime()>e,r.nextTitle.title=u?i(c,2===u?q.titleFormatMonth:q.titleFormatYear):l+10+' - '+(l+19),r.nextTitle.dpxValue=c.getTime(),2===u?c.setMonth(c.getMonth()-1):c.setFullYear(u?k:l),2===u){var m=q.weekDayLabels.length;!q.mondayFirst&&--m&&a('span',['dpx-item','dpx-weekday','dpx-weekend'],r.content,q.weekDayLabels[6]);for(var n=0;n<m;++n){var p=['dpx-item','dpx-weekday'];n>4&&p.push('dpx-weekend'),a('span',p,r.content,q.weekDayLabels[n])}}if(2===u){var s=c.getDay();c.setDate(q.mondayFirst?-(s?s-2:5):-s+1)}else u?c.setMonth(c.getMonth()-2):c.setFullYear(l-3);u<2&&(h.setDate(1),!u&&h.setMonth(0)),h=h.getTime(),r.container.setAttribute('data-dpx-type',['year','month','day'][u]);for(var v=['getFullYear','getMonth','getDate'][u],w=['setFullYear','setMonth','setDate'][u],x=2===u?6:4,y=2===u?7:4,z=[],A=x*y;A--;c[w](c[v]()+1)){var p=['dpx-item'],B=i(c,[q.titleFormatYear,q.titleFormatMonth,q.titleFormatDay][u]);(u?2===u?c.getMonth()!==j:c.getFullYear()!==k:c.getFullYear()<l||c.getFullYear()>l+9)&&p.push('dpx-out'),2===u&&(6===c.getDay()||0===c.getDay())&&p.push('dpx-weekend'),c.getTime()===h&&p.push('dpx-current'),c.getTime()===t&&p.push('dpx-selected');var C=u?2===u?c.getDate():q.shortMonthLabels[c.getMonth()]:c.getFullYear(),D=a('button',p,r.content,C,B);D.dpxValue=c.getTime(),D.disabled=c.getTime()<d||c.getTime()>e,z.push(D)}o(z,x,y)}function o(a,b,c){function d(a){return g.length?1===g.length?g[0]:r.title.disabled?g[Math.floor(a/Math.ceil(c/2))]:[r.prevTitle.disabled?r.title:r.prevTitle,r.prevTitle.disabled||c<7?r.title:r.prevTitle,r.title,r.nextTitle.disabled||c>4?r.title:r.nextTitle,r.title,r.nextTitle.disabled?r.title:r.nextTitle,r.nextTitle.disabled?r.title:r.nextTitle][a]:null}function e(a){return h.length?h[Math.floor(a/Math.ceil(c/h.length))]:null}function f(a,b,c){a.neighbors={left:c[b>0?b-1:c.length-1],right:c[b<c.length-1?b+1:0]}}var g=[];!r.prevTitle.disabled&&g.push(r.prevTitle),!r.title.disabled&&g.push(r.title),!r.nextTitle.disabled&&g.push(r.nextTitle);var h=[];r.today&&!r.today.disabled&&h.push(r.today),r.clear&&h.push(r.clear);var i=a.filter(function(a){return!a.disabled});g.forEach(function(a,b,c){f(a,b,c),a.neighbors.bottom=i[0],a.neighbors.top=h.length?h[0]:i[i.length-1]}),h.forEach(function(a,b,c){f(a,b,c),a.neighbors.top=i[i.length-1],a.neighbors.bottom=g.length?g[0]:i[0]});for(var j=0;j<c*b;j+=c)a.slice(j,j+c).filter(function(a){return!a.disabled}).forEach(f);for(var j=0;j<c;j++)a.filter(function(a,b){return!a.disabled&&b%c===j}).forEach(function(a,b,c){b?a.neighbors.top=c[b-1]:a.neighbors.top=d(j)||e(j)||c[c.length-1],b===c.length-1?a.neighbors.bottom=e(j)||d(j)||c[0]:a.neighbors.bottom=c[b+1]})}function p(a,b){if('undefined'==typeof q[a])return console.error('DatePickerX, setOption: Option doesn\'t exist.')&&!1;if('minDate'===a||'maxDate'===a){if(!(b instanceof HTMLInputElement)&&'function'!=typeof b&&(!(b instanceof Date)&&(b=new Date(b)),isNaN(b)))return console.error('DatePickerX, setOption: Invalid date value.')&&!1}else{if(typeof q[a]!=typeof b)return console.error('DatePickerX, setOption: Option has invalid type.')&&!1;if(Array.isArray(q[a])){if(b.length<q[a].length)return console.warn('DatePickerX, setOption: Invalid option length.')&&!1;b=b.slice(0,q[a].length)}}q[a]=b}var q={},r={},s=!1,t=null,u=2;return{init:function(a){if(a=a||{},s)return console.error('DatePickerX, init: Date picker has been already initiated.')&&!1;s=!0,q={};for(var b in d)q[b]=d[b];if('object'!=typeof a)console.error('DatePickerX, init: Initial options must be an object.');else for(var b in a)p(b,a[b]);return c.parentNode.classList.add('date-picker-x-container'),c.classList.add('date-picker-x-input'),c.readOnly=!0,h(),m(this),!0},remove:function(){return s?(c.parentNode.removeChild(r.container),c.classList.remove('date-picker-x-input'),c.readOnly=s=!1,!0):console.error('DatePickerX, remove: Date picker has not been initiated yet.')&&!1},setValue:function(a,b){if(!s)return console.error('DatePickerX, remove: Date picker has not been initiated yet.')&&!1;if(null===a)t=null,c.value='';else{if(!(a instanceof Date)&&(a=new Date(a)),isNaN(a))return console.error('DatePickerX, setValue: Can\'t convert argument to date.')&&!1;if(!b&&(a.getTime()<f().getTime()||a.getTime()>g().getTime()))return console.error('DatePickerX, setValue: Date out of acceptable range.')&&!1;t=a.getTime(),c.value=i(a,q.format)}var d=document.createEvent('Event');return d.initEvent('change',!0,!0),c.dispatchEvent(d),j()&&n(),!0},getValue:function(a){return!s&&console.error('DatePickerX, getValue: Date picker has not been initiated yet.'),a?t:null===t?'':i(new Date(t),q.format)},getMinDate:function(){var a=q.minDate;return a instanceof HTMLInputElement?a=a.DatePickerX.getMinDate():'function'==typeof a&&(a=new Date(a()),isNaN(a)&&(console.error('DatePickerX, getMinDate: Invalid date value.'),a=d.minDate)),b(a)},getMaxDate:function(){var a=q.maxDate;return a instanceof HTMLInputElement?a=a.DatePickerX.getMaxDate():'function'==typeof a&&(a=new Date(a()),isNaN(a)&&(console.error('DatePickerX, getMaxDate: Invalid date value.'),a=d.maxDate)),b(a)}}}var d={mondayFirst:!0,format:'yyyy/mm/dd',minDate:new Date(0,0),maxDate:new Date(9999,11,31),weekDayLabels:['Mo','Tu','We','Th','Fr','St','Su'],shortMonthLabels:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],singleMonthLabels:['January','February','March','April','May','June','July','August','September','October','November','December'],todayButton:!0,todayButtonLabel:'Today',clearButton:!0,clearButtonLabel:'Clear',titleFormatDay:'MM dd, yyyy',titleFormatMonth:'MM yyyy',titleFormatYear:'yyyy'},e=null,f=[],g=[];Object.defineProperty(HTMLInputElement.prototype,'DatePickerX',{get:function(){var a=f.indexOf(this);return a===-1&&(a=f.push(this)-1,g.push(new c(this))),g[a]},set:function(){}}),window.DatePickerX={setDefaults:function(a){if('object'!=typeof a)return console.error('DatePickerX, setDefaults: Invalid option type.')&&!1;for(var b in a)typeof a[b]==typeof d[b]&&(Array.isArray(d[b])?a[b].length>=d[b].length&&(d[b]=a[b].slice(0,d[b].length)):d[b]=a[b]);return!0}}}();